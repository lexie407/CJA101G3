<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æªåœ˜é é¢ - Itn è¡Œç¨‹å¡ç‰‡æ•´åˆç¯„ä¾‹</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 0;
        }
        
        .header {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin: 0;
        }
        
        .page-subtitle {
            font-size: 16px;
            color: #666;
            margin: 8px 0 0 0;
        }
        
        .main-content {
            padding: 40px 0;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }
        
        .filter-buttons {
            display: flex;
            gap: 12px;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .filter-btn:hover {
            background: #f5f5f5;
        }
        
        .filter-btn.active {
            background: #2196f3;
            color: white;
            border-color: #2196f3;
        }
        
        .loading-message {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 16px;
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        
        .stats {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        
        .stat-item {
            flex: 1;
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: #2196f3;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 4px;
        }
        
        .footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-top: 60px;
        }
    </style>
</head>
<body>
    <!-- é é¢æ¨™é¡Œ -->
    <div class="header">
        <div class="container">
            <h1 class="page-title">ğŸ¯ ç†±é–€è¡Œç¨‹æªåœ˜</h1>
            <p class="page-subtitle">ç™¼ç¾ç²¾å½©è¡Œç¨‹ï¼Œèˆ‡åŒå¥½ä¸€èµ·æ¢ç´¢å°ç£ä¹‹ç¾</p>
        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹ -->
    <div class="main-content">
        <div class="container">
            <!-- çµ±è¨ˆè³‡è¨Š -->
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalTrips">0</div>
                    <div class="stat-label">ç†±é–€è¡Œç¨‹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="avgRating">0.0</div>
                    <div class="stat-label">å¹³å‡è©•åˆ†</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="avgPrice">0</div>
                    <div class="stat-label">å¹³å‡åƒ¹æ ¼</div>
                </div>
            </div>

            <!-- ç¯©é¸å’Œæ¨™é¡Œ -->
            <div class="section-header">
                <h2 class="section-title">ç²¾é¸è¡Œç¨‹</h2>
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterTrips('all')">å…¨éƒ¨</button>
                    <button class="filter-btn" onclick="filterTrips('culture')">æ–‡åŒ–æ™¯é»</button>
                    <button class="filter-btn" onclick="filterTrips('food')">ç¾é£Ÿ</button>
                    <button class="filter-btn" onclick="filterTrips('nature')">è‡ªç„¶æ™¯è§€</button>
                    <button class="filter-btn" onclick="filterTrips('shopping')">è³¼ç‰©</button>
                </div>
            </div>

            <!-- è¡Œç¨‹å¡ç‰‡å®¹å™¨ -->
            <div id="groupActivityCards"></div>
        </div>
    </div>

    <!-- é å°¾ -->
    <div class="footer">
        <div class="container">
            <p>&copy; 2025 è¡Œç¨‹æªåœ˜å¹³å° - ä½¿ç”¨ Itn è¡Œç¨‹å¡ç‰‡å…ƒä»¶</p>
        </div>
    </div>

    <!-- å¼•å…¥ Itn è¡Œç¨‹å¡ç‰‡å…ƒä»¶ -->
    <script src="../components/itn-trip-card.js"></script>
    <script src="../components/itn-trip-card-data.js"></script>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let allTripsData = [];
        let currentFilter = 'all';

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });

        // åˆå§‹åŒ–é é¢
        function initializePage() {
            showLoadingMessage();
            
            // æ¨¡æ“¬å¾ API è¼‰å…¥è³‡æ–™
            setTimeout(() => {
                loadTripsData();
            }, 1000);
        }

        // è¼‰å…¥è¡Œç¨‹è³‡æ–™
        function loadTripsData() {
            try {
                // ä½¿ç”¨ç¯„ä¾‹è³‡æ–™ï¼ˆå¯¦éš›æ‡‰ç”¨ä¸­æœƒå¾ API ç²å–ï¼‰
                allTripsData = getItnTripSampleData('CATEGORIES');
                
                // æ›´æ–°çµ±è¨ˆè³‡è¨Š
                updateStats(allTripsData);
                
                // æ¸²æŸ“å¡ç‰‡
                renderTripCards(allTripsData);
                
            } catch (error) {
                showErrorMessage('è¼‰å…¥è¡Œç¨‹è³‡æ–™å¤±æ•—ï¼š' + error.message);
            }
        }

        // æ¸²æŸ“è¡Œç¨‹å¡ç‰‡
        function renderTripCards(data) {
            const options = {
                onRegisterClick: function(trip, cardElement) {
                    // å¯¦éš›æ‡‰ç”¨ä¸­æœƒè·³è½‰åˆ°å ±åé é¢
                    handleRegisterClick(trip);
                },
                onDetailClick: function(trip, cardElement) {
                    // å¯¦éš›æ‡‰ç”¨ä¸­æœƒè·³è½‰åˆ°è©³æƒ…é é¢
                    handleDetailClick(trip);
                },
                onCardClick: function(trip, cardElement) {
                    // å¡ç‰‡é»æ“Šæ•ˆæœ
                    console.log('æŸ¥çœ‹è¡Œç¨‹:', trip.title);
                }
            };

            // ä½¿ç”¨ Itn è¡Œç¨‹å¡ç‰‡å…ƒä»¶æ¸²æŸ“
            createItnTripCards('#groupActivityCards', data, options);
        }

        // è™•ç†å ±åæŒ‰éˆ•é»æ“Š
        function handleRegisterClick(trip) {
            // æ¨¡æ“¬å ±åæµç¨‹
            if (confirm(`ç¢ºå®šè¦å ±åã€Œ${trip.title}ã€å—ï¼Ÿ\nè²»ç”¨ï¼šNT$ ${trip.price.toLocaleString()}`)) {
                alert('å ±åæˆåŠŸï¼æˆ‘å€‘æœƒç›¡å¿«èˆ‡æ‚¨è¯ç¹«ç¢ºèªè©³æƒ…ã€‚');
                
                // å¯¦éš›æ‡‰ç”¨ä¸­çš„è™•ç†ï¼š
                // window.location.href = `/groupactivity/register/${trip.id}`;
                // æˆ–è€…æ‰“é–‹å ±åè¡¨å–®æ¨¡æ…‹æ¡†
            }
        }

        // è™•ç†è©³æƒ…æŒ‰éˆ•é»æ“Š
        function handleDetailClick(trip) {
            // æ¨¡æ“¬è©³æƒ…æŸ¥çœ‹
            const details = `
è¡Œç¨‹åç¨±ï¼š${trip.title}
è¡Œç¨‹æ—¥æœŸï¼š${trip.date}
è¡Œç¨‹æ™‚é•·ï¼š${trip.duration}
åœ˜é«”äººæ•¸ï¼š${trip.groupSize}
è²»ç”¨ï¼šNT$ ${trip.price.toLocaleString()}
è©•åˆ†ï¼š${trip.rating} â­

è¡Œç¨‹å®‰æ’ï¼š
${trip.itinerary.map(item => `â€¢ ${item.time} - ${item.name} (${item.duration})`).join('\n')}
            `;
            
            alert(details);
            
            // å¯¦éš›æ‡‰ç”¨ä¸­çš„è™•ç†ï¼š
            // window.location.href = `/groupactivity/detail/${trip.id}`;
            // æˆ–è€…æ‰“é–‹è©³æƒ…æ¨¡æ…‹æ¡†
        }

        // ç¯©é¸è¡Œç¨‹
        function filterTrips(category) {
            // æ›´æ–°ç¯©é¸æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // ç¯©é¸è³‡æ–™
            let filteredData = allTripsData;
            
            if (category !== 'all') {
                const categoryMap = {
                    'culture': 'æ–‡åŒ–æ™¯é»',
                    'food': 'ç¾é£Ÿ',
                    'nature': 'è‡ªç„¶æ™¯è§€',
                    'shopping': 'è³¼ç‰©',
                    'entertainment': 'å¨›æ¨‚'
                };
                
                const targetCategory = categoryMap[category];
                filteredData = allTripsData.filter(trip => 
                    trip.itinerary.some(item => item.category === targetCategory)
                );
            }

            currentFilter = category;
            
            // é‡æ–°æ¸²æŸ“å¡ç‰‡
            renderTripCards(filteredData);
            
            // æ›´æ–°çµ±è¨ˆ
            updateStats(filteredData);
        }

        // æ›´æ–°çµ±è¨ˆè³‡è¨Š
        function updateStats(data) {
            const totalTrips = data.length;
            const avgRating = totalTrips > 0 ? 
                (data.reduce((sum, trip) => sum + trip.rating, 0) / totalTrips).toFixed(1) : 0;
            const avgPrice = totalTrips > 0 ? 
                Math.round(data.reduce((sum, trip) => sum + trip.price, 0) / totalTrips) : 0;

            document.getElementById('totalTrips').textContent = totalTrips;
            document.getElementById('avgRating').textContent = avgRating;
            document.getElementById('avgPrice').textContent = avgPrice.toLocaleString();
        }

        // é¡¯ç¤ºè¼‰å…¥è¨Šæ¯
        function showLoadingMessage() {
            document.getElementById('groupActivityCards').innerHTML = `
                <div class="loading-message">
                    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ”„</div>
                    <p>æ­£åœ¨è¼‰å…¥ç²¾å½©è¡Œç¨‹...</p>
                </div>
            `;
        }

        // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
        function showErrorMessage(message) {
            document.getElementById('groupActivityCards').innerHTML = `
                <div class="error-message">
                    <div style="font-size: 48px; margin-bottom: 16px;">âš ï¸</div>
                    <p>${message}</p>
                    <button onclick="loadTripsData()" style="margin-top: 16px; padding: 8px 16px; background: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        é‡æ–°è¼‰å…¥
                    </button>
                </div>
            `;
        }

        // æª¢æŸ¥å…ƒä»¶è¼‰å…¥ç‹€æ…‹
        if (typeof ItnTripCardComponent === 'undefined') {
            console.error('âŒ Itn è¡Œç¨‹å¡ç‰‡å…ƒä»¶è¼‰å…¥å¤±æ•—');
            showErrorMessage('è¡Œç¨‹å¡ç‰‡å…ƒä»¶è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢');
        } else {
            console.log('âœ… Itn è¡Œç¨‹å¡ç‰‡å…ƒä»¶è¼‰å…¥æˆåŠŸ');
        }
    </script>
</body>
</html> 