<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{/back-end/spot/navBackTemplate :: layout(~{::title}, ~{::head}, ~{::main}, ~{::#subnav})}">
<head>
    <title>ÊôØÈªûÁÆ°ÁêÜ - ÂæåÂè∞ÁÆ°ÁêÜÁ≥ªÁµ±</title>
    <th:block th:fragment="head">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <!-- ÊôØÈªûÊ®°ÁµÑÈÄöÁî®Ê®£Âºè -->
        <link rel="stylesheet" th:href="@{/css/spot/back-end/spot-common.css}">
        <!-- ÊôØÈªûÂàóË°®Â∞àÁî®Ê®£Âºè -->
        <link rel="stylesheet" th:href="@{/css/spot/back-end/spot-list.css}">
        <script th:src="@{/js/spot/back-end/list.js?v=5}" defer></script>
        <!-- CSRF Token -->
        <meta name="_csrf" th:content="${_csrf.token}"/>
        <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    </th:block>
</head>
<body>
    <!-- This div will be passed as the 'subnav' parameter to the layout -->
    <div id="subnav" th:replace="~{subnavSpotBack :: subnav(activeItem='list')}"></div>

    <main th:fragment="main" class="spot-list-page">
                <!-- È†ÅÈù¢Ê®ôÈ°åÂçÄÂüü -->
                <div class="page-header-section">
                    <div class="header-content">
                        <div class="header-text">
                            <h1>ÊôØÈªûÁÆ°ÁêÜ</h1>
                            <p>ÁÆ°ÁêÜÁ≥ªÁµ±‰∏≠ÁöÑÊâÄÊúâÊôØÈªûË≥áÊñô</p>
                        </div>
                        <div class="header-image">
                            <img src="/images/logo.png" alt="ÊôØÈªûÁÆ°ÁêÜ" class="header-logo">
                        </div>
                    </div>
                </div>

                <!-- ÁØ©ÈÅ∏ÊéßÂà∂ÂçÄ -->
                <div class="filter-section">
                    <div class="filter-controls">
                        <div class="search-box">
                            <input type="text" placeholder="ÊêúÂ∞ãÊôØÈªûÂêçÁ®±„ÄÅÂú∞Èªû..." id="searchInput" th:value="${param.keyword}">
                            <span class="search-icon">üîç</span>
                </div>

                        <!-- ÁØ©ÈÅ∏ÊåâÈàïÁæ§ÁµÑ -->
                        <div class="filter-dropdown-group">
                            <!-- ÁãÄÊÖãÁØ©ÈÅ∏ -->
                            <div class="filter-dropdown" data-filter="status">
                                <button class="filter-btn" id="statusBtn">
                                    <span>ÁãÄÊÖãÁØ©ÈÅ∏</span>
                                    <span class="filter-arrow">‚ñº</span>
                                </button>
                                <div class="dropdown-menu" id="statusDropdown">
                                    <div class="dropdown-content">
                                        <div class="option-item">
                                            <input type="radio" name="status" value="all" id="status-all" checked>
                                            <label for="status-all">ÂÖ®ÈÉ®ÁãÄÊÖã</label>
                                        </div>
                                        <div class="option-item">
                                            <input type="radio" name="status" value="1" id="status-active">
                                            <label for="status-active">‰∏äÊû∂</label>
                                        </div>
                                        <div class="option-item">
                                            <input type="radio" name="status" value="2" id="status-rejected">
                                            <label for="status-rejected">ÈÄÄÂõû</label>
                                        </div>
                                        <div class="option-item">
                                            <input type="radio" name="status" value="3" id="status-inactive">
                                            <label for="status-inactive">‰∏ãÊû∂</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Âú∞ÂçÄÁØ©ÈÅ∏ -->
                            <div class="filter-dropdown" data-filter="region">
                                <button class="filter-btn" id="regionBtn">
                                    <span>Âú∞ÂçÄÁØ©ÈÅ∏</span>
                                    <span class="filter-arrow">‚ñº</span>
                                </button>
                                <div class="dropdown-menu" id="regionDropdown">
                                    <div class="dropdown-content">
                                        <div class="option-item">
                                            <input type="radio" name="region" value="all" id="region-all" checked>
                                            <label for="region-all">ÂÖ®ÈÉ®Âú∞ÂçÄ</label>
                                        </div>
                                        <!-- ÂãïÊÖãÁîüÊàêÂú∞ÂçÄÈÅ∏È†Ö -->
                                        <th:block th:each="region, iterStat : ${allRegions}">
                                            <div class="option-item">
                                                <input type="radio" name="region" th:value="${region}" th:id="'region-' + ${iterStat.index}">
                                                <label th:for="'region-' + ${iterStat.index}" th:text="${region}">Âú∞ÂçÄÂêçÁ®±</label>
                                            </div>
                                        </th:block>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ê∏ÖÈô§ÊåâÈàï -->
                            <button type="button" class="clear-btn">Ê∏ÖÈô§</button>
                        </div>
                        
                        <!-- Âè≥ÂÅ¥ÊéßÂà∂È†Ö -->
                        <div class="right-controls">
                            <!-- ÂàÜÈ†ÅÊéßÂà∂ -->
                            <div class="pagination-control">
                                <span>ÊØèÈ†ÅÈ°ØÁ§∫</span>
                                <select id="pageSizeSelect">
                                <option value="3">3 Á≠Ü</option>
                                <option value="5">5 Á≠Ü</option>
                                <option value="10" selected>10 Á≠Ü</option>
                                <option value="20">20 Á≠Ü</option>
                                <option value="30">30 Á≠Ü</option>
                            </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ÊàêÂäü/ÈåØË™§Ë®äÊÅØ -->
                <div th:if="${successMessage}" class="alert alert-success">
                        <i class="material-icons">check_circle</i>
                    <span th:text="${successMessage}"></span>
                </div>
                <div th:if="${errorMessage}" class="alert alert-error">
                        <i class="material-icons">error</i>
                    <span th:utext="${errorMessage}"></span> <!-- ‰ΩøÁî®utext‰ª•ÊîØÊåÅHTMLÊèõË°å -->
                </div>
                
                <!-- Ë°®Ê†ºÂçÄÂüü -->
                <div class="table-section">
                    <div class="table-header">
                        <div class="table-title-group">
                            <button class="sort-btn active" id="sortBtn" title="ÊéíÂ∫è">
                                <span class="sort-icon">‚Üï</span>
                                <span class="sort-text">ÊéíÂ∫è</span>
                            </button>
                                        <h2 class="table-title">
                ÊôØÈªûÂàóË°® <span class="count-badge" id="countBadge" 
                      th:text="|ÂÖ± ${spotPage.totalElements} Á≠Ü|">ÂÖ± 0 Á≠Ü</span>
            </h2>
                                </div>
                        <div class="table-actions">
                            <span class="selected-info hidden" id="selectedInfo">Â∑≤ÈÅ∏Êìá <span id="selectedCount">0</span> ÂÄãÈ†ÖÁõÆ</span>
                            <div class="batch-actions">
                                <button class="batch-btn hidden" id="batchBtn">
                                    ÊâπÈáèÊìç‰Ωú <span class="batch-btn-small">‚ñº</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                    <form id="batchForm" method="post">
                        <table class="sample-table">
                                            <thead>
                                                <tr>
                                <th><input type="checkbox" id="selectAll"></th>
                                <th>ID</th>
                                <th>ÊôØÈªûË≥áË®ä</th>
                                <th>Âú∞Èªû</th>
                                <th>ÁãÄÊÖã</th>
                                <th>Âª∫Á´ãÊôÇÈñì</th>
                                <th>Êìç‰Ωú</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                            <tr th:if="${spotPage.empty}">
                                <td colspan="7">
                                    <div class="empty-state-container">
                                        <div class="icon">üì≠</div>
                                        <div class="title">ÁõÆÂâçÊ≤íÊúâÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑÊôØÈªûË≥áÊñô</div>
                                        <div class="subtitle">Ë´ãË™øÊï¥ÁØ©ÈÅ∏Ê¢ù‰ª∂ÊàñÊ∏ÖÈô§ÁØ©ÈÅ∏</div>
                                        </div>
                                                    </td>
                                                </tr>
                            <tr th:each="spot : ${spotPage.content}" th:data-region="${spot.region}">
                                <td><input type="checkbox" name="spotIds" th:value="${spot.spotId}" class="spot-checkbox"></td>
                                <td><span class="spot-id" th:text="'#' + ${spot.spotId}">#58</span></td>
                                <td>
                                    <div class="spot-info">
                                        <!-- ÊôØÈªûÂúñÁâáÊàñ‰Ωî‰ΩçÁ¨¶ -->
                                        <th:block th:if="${spot.firstPictureUrl != null and !#strings.isEmpty(spot.firstPictureUrl)}">
                                            <img th:src="${spot.firstPictureUrl}" 
                                                 th:alt="${spot.spotName}" 
                                                 class="spot-image">
                                        </th:block>
                                        <th:block th:unless="${spot.firstPictureUrl != null and !#strings.isEmpty(spot.firstPictureUrl)}">
                                            <div class="spot-image-placeholder">üèûÔ∏è</div>
                                        </th:block>
                                        
                                        <!-- ÊôØÈªûÊñáÂ≠óË≥áË®ä -->
                                        <div class="spot-text-info">
                                            <div class="spot-name" th:text="${spot.spotName}">ÊôØÈªûÂêçÁ®±</div>
                                            <div class="spot-desc" th:text="${#strings.abbreviate(spot.spotDesc, 50)}">ÊôØÈªûÊèèËø∞...</div>
                                        </div>
                                    </div>
                                                    </td>
                                <td><span class="spot-location" th:text="${spot.spotLoc}">Âú∞Èªû</span></td>
                                <td>
                                    <span th:switch="${spot.spotStatus}">
                                        <span th:case="1" class="status-badge status-active">‰∏äÊû∂</span>
                                        <span th:case="2" class="status-badge status-rejected">ÈÄÄÂõû</span>
                                        <span th:case="3" class="status-badge status-inactive">‰∏ãÊû∂</span>
                                        <span th:case="*" class="status-badge">Êú™Áü•</span>
                                                        </span>
                                                    </td>
                                <td><span class="spot-date" th:text="${#temporals.format(spot.spotCreateAt, 'yyyy-MM-dd')}">2025-06-26</span></td>
                                <td data-label="Êìç‰Ωú">
                                    <div class="action-buttons">
                                        <a th:href="@{/admin/spot/detail/{id}(id=${spot.spotId})}" class="action-btn btn-view" title="Êü•Áúã">üëÅÔ∏è</a>
                                        <a th:href="@{/admin/spot/edit/{id}(id=${spot.spotId})}" class="action-btn btn-edit" title="Á∑®ËºØ">‚úèÔ∏è</a>
                                        <form th:action="@{/admin/spot/delete/{id}(id=${spot.spotId})}" method="post" class="action-form" th:data-spot-name="${spot.spotName}">
                                            <button type="submit" class="action-btn btn-delete" title="Âà™Èô§">üóëÔ∏è</button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </form>
                
                <!-- ÂâçÁ´ØÂàÜÈ†ÅÊéßÂà∂ -->
                <div class="pagination-container" id="paginationContainer">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                        <li class="page-item" id="firstPageBtn">
                            <button class="page-link">
                            <span class="material-icons">first_page</span>
                            </button>
                    </li>
                        <li class="page-item" id="prevPageBtn">
                            <button class="page-link">
                            <span class="material-icons">chevron_left</span>
                            </button>
                    </li>
                        <!-- È†ÅÁ¢ºÂÆπÂô® -->
                        <div id="pageNumbers"></div>
                        <li class="page-item" id="nextPageBtn">
                            <button class="page-link">
                            <span class="material-icons">chevron_right</span>
                            </button>
                    </li>
                        <li class="page-item" id="lastPageBtn">
                            <button class="page-link">
                            <span class="material-icons">last_page</span>
                            </button>
                    </li>
                </ul>
            </nav>
                <div class="pagination-info" id="paginationInfo">
                    <!-- ÂàÜÈ†ÅË≥áË®äÂ∞áÁî± JavaScript ÂãïÊÖãÊõ¥Êñ∞ -->
                </div>
                </div>
    </main>

    <!-- ÂÇ≥ÈÅûÂÖ®ÈÉ®Ë≥áÊñôÁµ¶ JavaScript -->
    <script>
        // ‰ΩøÁî®Á∞°ÂñÆÁöÑÊñπÂºèË®≠ÂÆöÂÖ®ÂüüËÆäÊï∏
        console.log('=== ÈñãÂßãË®≠ÂÆöÂÖ®ÂüüË≥áÊñô ===');
        
        // ÂòóË©¶Ë®≠ÂÆöÊôØÈªûË≥áÊñô
        try {
            /*<![CDATA[*/
            window.allSpotsData = /*[[${allSpotsJsonData}]]*/ [];
            /*]]>*/
            console.log('‚úÖ allSpotsData Ë®≠ÂÆöÊàêÂäüÔºåÂÖ±', window.allSpotsData.length, 'Á≠Ü');
        } catch (error) {
            console.error('‚ùå allSpotsData Ë®≠ÂÆöÂ§±Êïó:', error);
            window.allSpotsData = [];
        }
        
        // ÂòóË©¶Ë®≠ÂÆöÂú∞ÂçÄË≥áÊñô
        try {
            /*<![CDATA[*/
            window.allRegions = /*[[${allRegions}]]*/ [];
            /*]]>*/
            console.log('‚úÖ allRegions Ë®≠ÂÆöÊàêÂäüÔºåÂÖ±', window.allRegions.length, 'ÂÄã');
        } catch (error) {
            console.error('‚ùå allRegions Ë®≠ÂÆöÂ§±Êïó:', error);
            window.allRegions = [];
        }
        
        console.log('=== ÊúÄÁµÇÂÖ®ÂüüË≥áÊñôÊ™¢Êü• ===');
        console.log('window.allSpotsData È°ûÂûã:', typeof window.allSpotsData);
        console.log('window.allSpotsData ÊòØÂê¶ÁÇ∫Èô£Âàó:', Array.isArray(window.allSpotsData));
        console.log('window.allSpotsData Èï∑Â∫¶:', window.allSpotsData ? window.allSpotsData.length : 'undefined');
        console.log('window.allRegions È°ûÂûã:', typeof window.allRegions);
        console.log('window.allRegions ÊòØÂê¶ÁÇ∫Èô£Âàó:', Array.isArray(window.allRegions));
        console.log('window.allRegions Èï∑Â∫¶:', window.allRegions ? window.allRegions.length : 'undefined');
        
        if (window.allSpotsData && window.allSpotsData.length > 0) {
            console.log('Á¨¨‰∏ÄÁ≠ÜÊôØÈªûË≥áÊñô:', window.allSpotsData[0]);
        }
        console.log('=============================');
    </script>
    
    <!-- Â∞áÊâπÈáèÊìç‰ΩúÈÅ∏ÂñÆÁßªÂà∞Ê≠§ËôïÔºåÊàêÁÇ∫ body ÁöÑÁõ¥Â±¨Â≠êÂÖÉÁ¥†Ôºå‰ª•Ëß£Ê±∫Â±§Á¥öËàá overflow Ë£ÅÂàáÂïèÈ°å -->
    <div class="dropdown-menu" id="batchMenu">
        <button type="button" class="dropdown-item" data-action="activate">
            <span class="material-icons icon-success">check_circle</span> ÊâπÈáè‰∏äÊû∂
        </button>
        <button type="button" class="dropdown-item" data-action="deactivate">
            <span class="material-icons icon-warning">cancel</span> ÊâπÈáè‰∏ãÊû∂
        </button>
        <button type="button" class="dropdown-item danger" data-action="delete">
            <span class="material-icons icon-danger">delete</span> ÊâπÈáèÂà™Èô§
        </button>
    </div>
</body>
</html> 