<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>ç·¨è¼¯è¡Œç¨‹ - å¾Œå°ç®¡ç†ç³»çµ±</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- å¼•å…¥å¾Œå°æ¨¡æ¿çš„é ­éƒ¨è³‡æº -->
    <th:block th:replace="~{navBackTemplate :: headResources}"></th:block>
    
    <!-- è¡Œç¨‹æ¨¡çµ„å°ˆç”¨æ¨£å¼ -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/itinerary/back-end/itinerary-common.css}">
    <link rel="stylesheet" th:href="@{/css/itinerary/back-end/itinerary-form.css}">
    
    <!-- ğŸ”§ éåº¦éšæ®µï¼šè¨»è§£æ‰CSRF token -->
    <!-- <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/> -->
</head>
<body class="light">
    <div class="app-container">
        <!-- å¼•å…¥å¾Œå°å·¦å´å°èˆª -->
        <th:block th:replace="~{navBackTemplate :: navbar}"></th:block>
        
        <div class="main-content">
            <!-- é ‚éƒ¨å°èˆª -->
            <div th:replace="~{subnavContentBack :: subnav(activeItem='itn-list')}"></div>
            
            <!-- ä¸»è¦å…§å®¹ -->
            <main class="itinerary-review-page">
        <!-- è‹±é›„å€å¡Šå…¨å¯¬ -->
        <div class="page-header-section">
            <div class="header-content">
                <div class="header-text">
                    <h1>ç·¨è¼¯è¡Œç¨‹</h1>
                    <p>ä¿®æ”¹è¡Œç¨‹è³‡è¨Šï¼Œæ›´æ–°è¡Œç¨‹å…§å®¹</p>
                </div>
                <div class="header-image">
                    <img src="/images/logo.png" alt="è¡Œç¨‹ç®¡ç†ç³»çµ±" class="header-logo">
                </div>
            </div>
        </div>
        <div class="itinerary-form-page">

            <!-- æˆåŠŸ/éŒ¯èª¤è¨Šæ¯ -->
            <div th:if="${successMessage}" class="alert alert-success">
                <i class="material-icons">check_circle</i>
                <span th:text="${successMessage}"></span>
            </div>
            <div th:if="${errorMessage}" class="alert alert-error">
                <i class="material-icons">error</i>
                <span th:utext="${errorMessage}"></span>
            </div>
            <!-- è¡¨å–®å…§å®¹å€åŸŸ -->
            <div class="content-container">
                <form th:action="@{/admin/itinerary/edit/{id}(id=${itinerary.itnId})}" method="post" id="itineraryForm" class="itinerary-form">

                    <!-- åŸºæœ¬è³‡è¨Šå€å¡Š -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <i class="material-icons">info</i>
                                åŸºæœ¬è³‡è¨Š
                            </h2>
                            <p class="section-desc">è«‹ä¿®æ”¹è¡Œç¨‹çš„åŸºæœ¬è³‡è¨Š</p>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="itnName" class="form-label">
                                    è¡Œç¨‹åç¨± <span class="required">*</span>
                                </label>
                                <div class="input-container">
                                    <i class="material-icons input-icon">map</i>
                                    <input id="itnName" type="text" class="form-control" 
                                           name="itnName" required maxlength="50"
                                           placeholder="è«‹è¼¸å…¥è¡Œç¨‹åç¨±"
                                           th:value="${itinerary.itnName}">
                                </div>
                                <div class="helper-text">è«‹è¼¸å…¥è¡Œç¨‹çš„æ­£å¼åç¨±ï¼Œæœ€å¤š50å€‹å­—å…ƒ <span class="char-count">(0/50)</span></div>
                            </div>

                            <div class="form-group form-group-full">
                                <label for="itnDesc" class="form-label">è¡Œç¨‹æè¿°</label>
                                <textarea id="itnDesc" class="form-control form-textarea" 
                                          name="itnDesc" maxlength="500" rows="4"
                                          placeholder="è©³ç´°æè¿°è¡Œç¨‹ç‰¹è‰²ã€è·¯ç·šå®‰æ’æˆ–éŠè¦½é‡é»..."
                                          th:text="${itinerary.itnDesc}"></textarea>
                                <div class="helper-text">è©³ç´°æè¿°è¡Œç¨‹ç‰¹è‰²ã€è·¯ç·šå®‰æ’æˆ–éŠè¦½é‡é»ï¼Œæœ€å¤š500å€‹å­—å…ƒ <span class="char-count">(0/500)</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- ç‹€æ…‹è¨­å®šå€å¡Š -->
                    <div class="form-section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <i class="material-icons">toggle_on</i>
                                ç‹€æ…‹è¨­å®š
                            </h2>
                            <p class="section-desc">è¨­å®šè¡Œç¨‹çš„é¡¯ç¤ºç‹€æ…‹</p>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">å…¬é–‹ç‹€æ…‹</label>
                                <div class="status-card">
                                    <div class="status-switch-container">
                                        <label class="status-switch">
                                            <input type="checkbox" id="statusCheckbox" name="isPublicEnabled" 
                                                   th:checked="${itinerary.isPublic == 1}">
                                            <span class="switch-slider"></span>
                                        </label>
                                        <div class="status-info">
                                            <span class="status-text" th:text="${itinerary.isPublic == 1 ? 'å…¬é–‹' : 'ç§äºº'}">å…¬é–‹</span>
                                            <div class="status-badge" th:classappend="${itinerary.isPublic == 1 ? 'badge-success' : 'badge-secondary'}">
                                                <i class="material-icons" th:text="${itinerary.isPublic == 1 ? 'visibility' : 'visibility_off'}">visibility</i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="helper-text">å…¬é–‹çš„è¡Œç¨‹æœƒé¡¯ç¤ºæ–¼å‰å°ï¼Œç§äººçš„è¡Œç¨‹å‰‡æœƒéš±è—</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- éš±è—æ¬„ä½ -->
                    <input type="hidden" name="isPublic" id="isPublic" th:value="${itinerary.isPublic}">

                    <!-- æ“ä½œæŒ‰éˆ•å€åŸŸ -->
                    <div class="form-actions">
                        <a th:href="@{/admin/itinerary/itnlist}" class="btn btn-secondary">
                            <i class="material-icons">arrow_back</i>
                            è¿”å›åˆ—è¡¨
                        </a>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="material-icons">save</i>
                            <span>æ›´æ–°è¡Œç¨‹</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- è¡¨å–®é é¢å°ˆç”¨è…³æœ¬ -->
        <script th:src="@{/js/itinerary/back-end/form.js}" defer></script>
        
        <!-- ç°¡åŒ–çš„æŒ‰éˆ•é¡¯ç¤ºç¢ºä¿è…³æœ¬ -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // ç°¡å–®ç¢ºä¿æŒ‰éˆ•é¡¯ç¤º
                const formActions = document.querySelector('.form-actions');
                const buttons = document.querySelectorAll('.btn');
                
                if (formActions) formActions.style.display = 'flex';
                buttons.forEach(btn => btn.style.display = 'inline-flex');
                
                console.log('ç·¨è¼¯è¡Œç¨‹é é¢è¼‰å…¥å®Œæˆï¼ŒæŒ‰éˆ•æ•¸é‡:', buttons.length);
                
                // åˆå§‹åŒ–å­—å…ƒè¨ˆæ•¸
                const nameInput = document.getElementById('itnName');
                const descTextarea = document.getElementById('itnDesc');
                
                if (nameInput) {
                    const nameCount = nameInput.value.length;
                    const nameCountSpan = document.querySelector('#itnName').closest('.form-group').querySelector('.char-count');
                    if (nameCountSpan) nameCountSpan.textContent = `(${nameCount}/50)`;
                }
                
                if (descTextarea) {
                    const descCount = descTextarea.value.length;
                    const descCountSpan = document.querySelector('#itnDesc').closest('.form-group').querySelector('.char-count');
                    if (descCountSpan) descCountSpan.textContent = `(${descCount}/500)`;
                }
            });
        </script>
            </main>
        </div>
    </div>
</body>
</html> 